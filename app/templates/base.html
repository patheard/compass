<!DOCTYPE html>
<html dir="ltr" lang="{{ get_locale() }}">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ _(title) }} - {{ _('Compass') }}</title>

    <link rel="stylesheet" href="https://cdn.design-system.alpha.canada.ca/@cdssnc/gcds-utility@1.9.2/dist/gcds-utility.min.css">
    <link rel="stylesheet" href="https://cdn.design-system.alpha.canada.ca/@cdssnc/gcds-components@0.40.0/dist/gcds/gcds.css">
    <link rel="stylesheet" href="/static/css/main.css">

    <script type="module" src="https://cdn.design-system.alpha.canada.ca/@cdssnc/gcds-components@0.40.0/dist/gcds/gcds.esm.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.5.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/markdown-it@14.1.0/dist/markdown-it.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.2.7/dist/purify.min.js"></script>
    <script src="/static/js/scripts.js"></script>
    <script src="/static/js/files.js"></script>

    <link rel="icon" type="image/x-icon" sizes="96x96" href="/static/favicon.ico">
  </head>

  <body>
    <gcds-header lang-href="/lang/{% if get_locale() == 'en' %}fr{% else %}en{% endif %}" skip-to-href="#main-content">
      <gcds-top-nav slot="menu" label="Main menu" alignment="right">
        <gcds-nav-link slot="home" href="/">{{ _('Compass') }}</gcds-nav-link>
        {% if user %}
          <gcds-nav-link href="/">{{ _('Assessments') }}</gcds-nav-link>
          <gcds-nav-link href="/job-templates">{{ _('Job templates') }}</gcds-nav-link>
          <gcds-nav-link href="/auth/logout">{{ _('sign_out') }}</gcds-nav-link>
        {% else %}
          <gcds-nav-link href="/auth/login">{{ _('sign_in') }}</gcds-nav-link>
        {% endif %}
      </gcds-top-nav>

      <gcds-breadcrumbs slot="breadcrumb">
        {% if breadcrumbs %}
          {% for breadcrumb in breadcrumbs %}
            <gcds-breadcrumbs-item href="{{ breadcrumb.link }}">{{ _(breadcrumb.label) }}</gcds-breadcrumbs-item>
          {% endfor %}
        {% endif %}
      </gcds-breadcrumbs>
    </gcds-header>

    <gcds-container id="main-content" main-container size="xl" centered tag="main">
      {% block content %}
      {% endblock %}

      <div class="mt-600 mb-300">{{ _('version') }} {{ version }}</div>
    </gcds-container>

    <gcds-footer display="full"></gcds-footer>
    
    <div id="confirmModal" class="modal-overlay">
      <div class="modal-content">
        <gcds-text id="modalMessage">{{ _('Are you sure you want to continue? This action cannot be undone.') }}</gcds-text>
        <gcds-button id="modalConfirm" button-role="danger">{{ _('Yes') }}</gcds-button>
        <gcds-button id="modalCancel" button-role="secondary">{{ _('Cancel') }}</gcds-button>
      </div>
    </div>

    {% if user %}
      <a id="sliding-panelToggle" 
        class="sliding-panel-toggle" 
        href="#" aria-controls="sliding-panel" 
        aria-expanded="false" title="{{ _('Ask AI questions about your assessment') }}">
        ðŸ§­
      </a>

      <section id="sliding-panel" class="sliding-panel" role="complementary" aria-hidden="true" data-csrf-token="{{ csrf_token if csrf_token else '' }}">
        <div class="sliding-panel-header">
          <h2><abbr title="{{ _('Security Assessment Automation Platform') }}">{{ _('SAAP') }}</abbr> {{ _('chat') }}</h2>
          <a href="#" id="sliding-panel-close" aria-controls="sliding-panel"><gcds-icon name="close" size="h3"></gcds-icon></a>
        </div>
        <div class="sliding-panel-body">
          <div id="llm-chat" class="chat-container" aria-live="polite" role="log"></div>
          <div class="sliding-panel-footer">
            <div id="loading"><div class="dot-flashing"></div></div>
            <gcds-textarea
              textarea-id="prompt"
              label="{{ _('Prompt') }}"
              name="prompt"
              hide-label="true"
              rows="3"
              data-placeholder="{{ _('Ask your question and press Enter') }}">
            </gcds-textarea>
            <div class="actions">
              <a href="#" id="clear-session"><img src="/static/img/clear.svg" title="{{ _('Clear') }}" alt="{{ _('Clear') }}"></a>
              <a href="#" id="send-message"><img src="/static/img/send.svg" title="{{ _('Send') }}" alt="{{ _('Send') }}"></a>
            </div>
          </div>
        </div>
      </section>
    {% endif %}

  </body>
</html>