{% extends "base.html" %}

{% block content %}
<gcds-heading tag="h1">{{ evidence.title }}</gcds-heading>
<gcds-text>
    {{ evidence.description }}
</gcds-text>

<ul class="list-disc mb-300" class="sm">
    <li>
        <strong>{{ _('Type:') }}</strong>
        {{ _(evidence.evidence_type) }}
    </li>
{% if evidence.is_automated_collection %}
{% if job_template %}
    <li>
        <strong>{{ _('Job name:') }}</strong>
        <gcds-link href="/job-templates/{{ job_template.template_id }}">{{ job_template.name }} ({{ job_template.scan_type }})</gcds-link>
    </li>
    <li>
        <strong>{{ _('Description:') }}</strong>
        {{ job_template.description }}
    </li>
    <li>
        <strong>{{ _('AWS Account ID:') }}</strong>
        {{ evidence.aws_account_id }}
    </li>
{% endif %}
{% endif %}
</ul>



{% if evidence.is_automated_collection %}
{% if job_executions %}
<gcds-heading tag="h2" class="mb-200">{{ _('Scans') }}</gcds-heading>
<section class="table-container mb-300">
    <table>
        <thead>
            <tr>
                <th scope="col">{{ _('Status') }}</th>
                <th scope="col">{{ _('Started At') }}</th>
                <th scope="col">{{ _('Completed At') }}</th>
                <th scope="col">{{ _('Result') }}</th>
            </tr>
        </thead>
        <tbody>
            {% for execution in job_executions %}
            <tr>
                <td>{{ _(execution.status) }}</td>
                <td>{{ execution.started_at.strftime('%Y-%m-%d %H:%M:%S') }}</td>
                <td>{{ execution.completed_at.strftime('%Y-%m-%d %H:%M:%S') }}</td>
                <td>
                    {% if execution.result_data and execution.result_data.rule_details %}
                    <div class="result-rule-icons" style="display:flex;flex-wrap:wrap;gap:.25rem;">
                        {% for rule_name, rule_info in execution.result_data.rule_details.items() %}
                            {% set compliance = rule_info.compliance_type %}
                            <span title="{{ rule_name }}" aria-label="{{ rule_name }}: {{ compliance }}">
                                {% if compliance == 'COMPLIANT' %}✅{% else %}❌{% endif %}
                            </span>
                        {% endfor %}
                    </div>
                    {% else %}
                        {{ execution.result_data }}
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</section>
{% endif %}
{% endif %}

<gcds-button href="/assessments/{{ assessment.assessment_id }}/controls/{{ control.control_id }}/evidence/{{ evidence.evidence_id }}/edit" type="link" button-role="primary" class="mt-300">
    {{ _("Edit") }}
</gcds-button>
<gcds-button href="/assessments/{{ assessment.assessment_id }}/controls/{{ control.control_id }}/evidence/{{ evidence.evidence_id }}/delete" type="link" button-role="secondary" data-csrf-token="{{ csrf_token }}" class="delete-item">
    {{ _("Delete") }}
</gcds-button>



{% endblock %}